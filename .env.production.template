# KnowledgeBeast Production Security Configuration Template
# ============================================================================
# Copy this file to .env.production and customize for your environment
# NEVER commit .env.production to version control
# ============================================================================

# ============================================================================
# CRITICAL SECURITY SETTINGS - CONFIGURE BEFORE DEPLOYMENT
# ============================================================================

# API Authentication (REQUIRED)
# Generate strong keys with: openssl rand -hex 32
# Multiple keys: Comma-separated for different clients/services
KB_API_KEY=REPLACE_WITH_SECURE_KEY_1,REPLACE_WITH_SECURE_KEY_2

# CORS Allowed Origins (REQUIRED)
# Use exact domains, NEVER use wildcard (*)
# Example: https://app.example.com,https://api.example.com
KB_ALLOWED_ORIGINS=https://REPLACE_WITH_YOUR_DOMAIN

# ============================================================================
# NETWORK SECURITY
# ============================================================================

# Force HTTPS (production only)
KB_HTTPS_ONLY=true

# Request Size Limits (DoS Protection)
# Adjust based on your use case:
# - API-only: 5242880 (5 MB)
# - File uploads: 52428800 (50 MB)
# - Public API: 1048576 (1 MB)
KB_MAX_REQUEST_SIZE=5242880

# Query String Length Limit
# Adjust based on expected query complexity:
# - Standard: 5000-10000
# - Restricted: 1000
KB_MAX_QUERY_LENGTH=5000

# Rate Limiting (requests per minute per API key)
# Adjust based on expected traffic:
# - Light traffic: 30-60
# - Moderate traffic: 100-200
# - High traffic: 500-1000
KB_RATE_LIMIT_PER_MINUTE=60

# ============================================================================
# DATA PROTECTION
# ============================================================================

# Data directory (ensure proper permissions: 700)
KB_DATA_DIR=/data

# Configuration directory (ensure proper permissions: 700)
KB_CONFIG_DIR=/config

# Cache file location (ensure permissions: 600)
# Note: KnowledgeBeast uses secure JSON cache (pickle removed)
KB_CACHE_FILE=/data/cache.json

# Knowledge base directories (read-only recommended)
KB_KNOWLEDGE_DIRS=/knowledge

# ============================================================================
# LOGGING & MONITORING
# ============================================================================

# Log level
# - Production: INFO
# - Troubleshooting: DEBUG (temporary only)
# - Development: DEBUG
KB_LOG_LEVEL=INFO

# Enable comprehensive request logging
# Logs: method, path, status, timing, client IP, request ID
KB_ENABLE_REQUEST_LOGGING=true

# Enable security event logging
# Logs: auth attempts, rate limits, CORS violations, anomalies
KB_ENABLE_SECURITY_LOGGING=true

# Log retention (configure in logrotate)
# - Security logs: 365 days
# - Access logs: 90 days
# - Debug logs: 7 days

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================

# API Server Host
# - 0.0.0.0: Bind to all interfaces (when using reverse proxy)
# - 127.0.0.1: Bind to localhost only (direct access)
KB_API_HOST=0.0.0.0

# API Server Port
KB_API_PORT=8000

# Worker Processes
# - Development: 1
# - Production (low traffic): 2-4
# - Production (high traffic): 4-8
# Rule of thumb: (2 x CPU cores) + 1
KB_API_WORKERS=2

# Hot Reload (development only - NEVER enable in production)
KB_API_RELOAD=false

# ============================================================================
# TIMEOUTS & PERFORMANCE
# ============================================================================

# Request timeout (seconds)
# Increase if processing long-running queries
KB_REQUEST_TIMEOUT=30

# Graceful shutdown timeout (seconds)
KB_SHUTDOWN_TIMEOUT=10

# Thread pool size for CPU-bound tasks
# Recommended: Number of CPU cores
KB_THREAD_POOL_SIZE=4

# Enable async mode for I/O operations
KB_ASYNC_MODE=true

# ============================================================================
# QUERY & CACHING
# ============================================================================

# Enable query result caching
KB_ENABLE_QUERY_CACHE=true

# Query cache TTL (seconds)
# Adjust based on data freshness requirements
KB_QUERY_CACHE_TTL=3600

# Maximum cache size (number of entries)
KB_MAX_CACHE_SIZE=1000

# Default number of results to return
KB_DEFAULT_LIMIT=10

# Maximum number of results allowed per query
KB_MAX_LIMIT=100

# Similarity threshold for retrieval (0.0 to 1.0)
KB_SIMILARITY_THRESHOLD=0.0

# ============================================================================
# REDIS CACHE (OPTIONAL - For distributed rate limiting)
# ============================================================================

# Enable Redis caching
# Required for: multi-instance deployments, distributed rate limiting
KB_REDIS_ENABLED=false

# Redis host
KB_REDIS_HOST=redis

# Redis port
KB_REDIS_PORT=6379

# Redis database number
KB_REDIS_DB=0

# Redis password (if required)
# Generate with: openssl rand -hex 32
# KB_REDIS_PASSWORD=REPLACE_WITH_SECURE_PASSWORD

# Redis connection timeout (seconds)
KB_REDIS_TIMEOUT=5

# ============================================================================
# VECTOR DATABASE (ChromaDB)
# ============================================================================

# ChromaDB storage path
KB_VECTOR_DB_PATH=/data/chroma_db

# Embedding model (sentence-transformers)
# Options:
# - all-MiniLM-L6-v2 (default, fast, good quality)
# - all-mpnet-base-v2 (slower, better quality)
# - multi-qa-MiniLM-L6-cos-v1 (optimized for Q&A)
KB_EMBEDDING_MODEL=all-MiniLM-L6-v2

# Collection name
KB_COLLECTION_NAME=knowledge_base

# ============================================================================
# DOCUMENT PROCESSING
# ============================================================================

# Maximum upload file size (bytes)
# Note: Should be <= KB_MAX_REQUEST_SIZE
KB_MAX_UPLOAD_SIZE=10485760

# Text chunk size for splitting documents
KB_CHUNK_SIZE=1000

# Chunk overlap for better context preservation
KB_CHUNK_OVERLAP=200

# Minimum chunk size (smaller chunks discarded)
KB_MIN_CHUNK_SIZE=100

# Batch size for bulk operations
KB_BATCH_SIZE=100

# ============================================================================
# MONITORING & OBSERVABILITY (OPTIONAL)
# ============================================================================

# Enable performance metrics (Prometheus)
# KB_ENABLE_METRICS=true

# Metrics export port
# KB_METRICS_PORT=9090

# Sentry DSN for error tracking
# KB_SENTRY_DSN=https://your-sentry-dsn-here

# OpenTelemetry configuration
# KB_OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317

# ============================================================================
# BACKUP & DISASTER RECOVERY
# ============================================================================

# Backup directory
# KB_BACKUP_DIR=/backups

# Backup retention (days)
# KB_BACKUP_RETENTION_DAYS=30

# Enable automatic backups
# KB_AUTO_BACKUP_ENABLED=true

# Backup schedule (cron format)
# KB_BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM

# ============================================================================
# COMPLIANCE & REGULATIONS
# ============================================================================

# GDPR data retention (days)
# KB_GDPR_DATA_RETENTION_DAYS=365

# Enable audit logging for compliance
# KB_AUDIT_LOGGING_ENABLED=true

# Audit log file
# KB_AUDIT_LOG_FILE=/data/audit.log

# ============================================================================
# ADVANCED SECURITY (OPTIONAL)
# ============================================================================

# IP Whitelist (comma-separated)
# Restrict access to specific IP addresses/ranges
# KB_IP_WHITELIST=203.0.113.0/24,198.51.100.42

# Geo-blocking (comma-separated country codes)
# Block requests from specific countries
# KB_GEO_BLOCK_COUNTRIES=CN,RU,KP

# Enable Web Application Firewall (WAF) rules
# KB_WAF_ENABLED=true

# JWT secret (if implementing JWT authentication)
# Generate with: openssl rand -hex 64
# KB_JWT_SECRET=REPLACE_WITH_SECURE_JWT_SECRET
# KB_JWT_ALGORITHM=HS256
# KB_JWT_EXPIRATION_SECONDS=3600

# ============================================================================
# DEVELOPMENT & DEBUGGING (NEVER ENABLE IN PRODUCTION)
# ============================================================================

# Debug mode (NEVER enable in production)
KB_DEBUG=false

# Development mode (NEVER enable in production)
# KB_DEV_MODE=false

# Disable authentication (NEVER do in production)
# KB_DISABLE_AUTH=false

# ============================================================================
# END OF CONFIGURATION
# ============================================================================

# Security Checklist:
# [ ] Generated strong API keys (openssl rand -hex 32)
# [ ] Configured exact CORS origins (no wildcard)
# [ ] Enabled HTTPS enforcement
# [ ] Set appropriate request size limits
# [ ] Configured rate limiting
# [ ] Set log level to INFO (not DEBUG)
# [ ] Disabled hot reload
# [ ] Disabled debug mode
# [ ] Verified file permissions (chmod 600 .env.production)
# [ ] Added .env.production to .gitignore
# [ ] Reviewed all OPTIONAL settings for your use case
# [ ] Tested configuration in staging before production

# Related Documentation:
# - Security Best Practices: docs/guides/security-best-practices.md
# - Production Checklist: docs/deployment/production-security-checklist.md
# - Security Configuration: docs/deployment/security.md
# - Main Security Policy: SECURITY.md
