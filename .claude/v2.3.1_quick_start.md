# v2.3.1 Quick Start Guide

## TL;DR

**Goal**: Complete remaining 4 improvements from v2.3.0 (67% ‚Üí 100%)
**Strategy**: 2 autonomous agents in parallel (7h + 10h)
**Timeline**: 5 days (Oct 9-13)
**Expected Grade**: A- (90/100) ‚Üí A (92/100)

---

## Launch Commands

### Step 1: Create Worktrees

```bash
cd /Users/danielconnolly/Projects/KnowledgeBeast
./.claude/launch_v2.3.1_agents.sh
```

This will:
- Clean up any existing worktrees
- Create `../KnowledgeBeast-agent1` (production-hardening branch)
- Create `../KnowledgeBeast-agent2` (security-observability branch)
- Display agent instructions

### Step 2: Launch Agent 1 (Production Hardening - 7h)

Use Claude Code Task tool with this prompt:

```
You are Agent 1: Production Hardening. Your working directory is:
/Users/danielconnolly/Projects/KnowledgeBeast-agent1

Your branch: feature/production-hardening (65% complete)

Tasks (7 hours total):
1. Fix test isolation (2h) - 12 flaky tests in tests/api/test_project_endpoints.py
2. Per-project rate limiting (2h) - NEW FEATURE
3. Project resource quotas (3h) - NEW FEATURE

Success criteria:
- 52/52 tests passing (currently 22/34)
- Rate limiting with composite keys {api_key}:{project_id}
- Quota enforcement (documents, storage, queries)

Detailed plan: /Users/danielconnolly/Projects/KnowledgeBeast/.claude/v2.3.1_completion_plan.md

Read sections:
- "Agent 1: Production Hardening Branch" (full details)
- All 3 task implementations

Start with Task 1 (test isolation), then proceed sequentially.
Create 1 commit per task (3 total).
When complete, create PR with title "feat: Production hardening completion (v2.3.1)"
```

### Step 3: Launch Agent 2 (Security & Observability - 10h)

Use Claude Code Task tool with this prompt:

```
You are Agent 2: Security & Observability. Your working directory is:
/Users/danielconnolly/Projects/KnowledgeBeast-agent2

Your branch: feature/security-observability (65% complete)

Tasks (10 hours total):
1. Complete route instrumentation (2h) - Add metrics to all endpoints
2. Distributed tracing context (3h) - Add project_id to all traces
3. Comprehensive tests (2h) - 39 tests for auth, metrics, tracing
4. API documentation (4h) - Multi-project guide (~1500 lines)

Success criteria:
- 39/39 tests passing
- All routes emit project-scoped metrics
- All operations traced with project context
- Complete API documentation with examples

Detailed plan: /Users/danielconnolly/Projects/KnowledgeBeast/.claude/v2.3.1_completion_plan.md

Read sections:
- "Agent 2: Security & Observability Branch" (full details)
- All 4 task implementations

Start with Task 1 (route instrumentation), then proceed sequentially.
Create 1 commit per task (4 total).
When complete, create PR with title "feat: Security & Observability completion (v2.3.1)"
```

---

## Agent Work Breakdown

### Agent 1: Production Hardening (7h)

| Task | Time | Files | Tests | Status |
|------|------|-------|-------|--------|
| 1. Fix test isolation | 2h | conftest.py, test_project_endpoints.py | 34/34 | üü° 65% |
| 2. Per-project rate limiting | 2h | rate_limiter.py, routes.py | +8 | ‚è≥ NEW |
| 3. Project resource quotas | 3h | project_manager.py, routes.py | +10 | ‚è≥ NEW |
| **Total** | **7h** | **5 files** | **52/52** | **üéØ** |

### Agent 2: Security & Observability (10h)

| Task | Time | Files | Tests | Status |
|------|------|-------|-------|--------|
| 1. Route instrumentation | 2h | routes.py, app.py | N/A | üü° 65% |
| 2. Distributed tracing | 3h | observability.py, project_manager.py | +12 | ‚è≥ NEW |
| 3. Comprehensive tests | 2h | 3 test files | +27 | ‚è≥ NEW |
| 4. API documentation | 4h | MULTI_PROJECT_GUIDE.md + examples | N/A | ‚è≥ NEW |
| **Total** | **10h** | **10 files** | **39/39** | **üéØ** |

---

## Merge Strategy

### Order (IMPORTANT!)

1. **Agent 2 merges FIRST** (simpler, fewer conflicts)
2. **Agent 1 merges SECOND** (rebases on updated main)

### Commands

```bash
# After Agent 2 completes
cd /Users/danielconnolly/Projects/KnowledgeBeast-agent2
gh pr create --title "feat: Security & Observability completion (v2.3.1)"
gh pr merge --squash

# After Agent 1 completes
cd /Users/danielconnolly/Projects/KnowledgeBeast-agent1
git fetch origin
git rebase origin/main  # Rebase on Agent 2 changes
gh pr create --title "feat: Production hardening completion (v2.3.1)"
gh pr merge --squash

# Tag release
cd /Users/danielconnolly/Projects/KnowledgeBeast
git checkout main
git pull origin main
git tag -a v2.3.1 -m "KnowledgeBeast v2.3.1 - Complete v2.3.0 Improvements"
git push origin v2.3.1
```

---

## Expected Results

### Test Coverage
- **Before**: 1,413 tests (78.4% pass rate)
- **After**: 1,470 tests (85%+ pass rate)
- **New Tests**: +57 tests (52 + 39 - 34 fixed)

### Features
- **Before v2.3.1**: 8/12 improvements (67%)
- **After v2.3.1**: 12/12 improvements (100%)

### Grade
- **Before**: A- (90/100)
- **After**: A (92/100)
- **Improvement**: +2 points

### Timeline
- **Day 1-2**: Agents work in parallel
- **Day 3**: PR creation and review
- **Day 4**: Merge PRs (Agent 2, then Agent 1)
- **Day 5**: Tag and release v2.3.1

---

## Troubleshooting

### If Agent 1 gets stuck on test isolation
- Run `pytest tests/api/test_project_endpoints.py -v --tb=short` to see errors
- Check that `tests/api/conftest.py` has proper cleanup
- Ensure ChromaDB collections are deleted between tests
- Verify database files are cleaned up

### If Agent 2 metrics don't appear
- Check `/metrics` endpoint: `curl http://localhost:8000/metrics`
- Verify prometheus_client is installed
- Check that `record_project_*()` functions are called
- Ensure metrics are registered on app startup

### If merge conflicts occur
- Agent 2 should merge first (simpler)
- Agent 1 rebases: `git rebase origin/main`
- Conflicts will be in `knowledgebeast/api/routes.py`
- Keep both changes (metrics + rate limiting)

### If tests fail after merge
- Run full suite: `pytest tests/ -v`
- Check for import errors
- Verify all dependencies installed
- Re-run cleanup script: `./.claude/cleanup.sh`

---

## Resources

### Documentation
- **Complete Plan**: `.claude/v2.3.1_completion_plan.md` (5,800+ lines)
- **Agent Workflow**: `.claude/v2.3.1_agent_workflow.md` (visual diagrams)
- **This Guide**: `.claude/v2.3.1_quick_start.md`

### Branches
- **Agent 1**: `feature/production-hardening`
- **Agent 2**: `feature/security-observability`
- **Main**: `main` (target for merge)

### Test Commands
```bash
# Agent 1 tests
pytest tests/api/test_project_endpoints.py -v
pytest tests/api/test_rate_limiting.py -v
pytest tests/api/test_quotas.py -v

# Agent 2 tests
pytest tests/api/test_project_api_keys.py -v
pytest tests/observability/test_project_metrics.py -v
pytest tests/observability/test_project_tracing.py -v

# Full suite
pytest tests/ -v --tb=short
```

---

## Success Checklist

### Agent 1
- [ ] 34/34 API tests passing (test isolation fixed)
- [ ] 8/8 rate limiting tests passing
- [ ] 10/10 quota tests passing
- [ ] Rate limiting returns 429 when exceeded
- [ ] Quotas return 402 when exceeded
- [ ] Quota endpoint returns accurate usage
- [ ] 3 commits created
- [ ] PR created and ready for review

### Agent 2
- [ ] All routes instrumented with metrics
- [ ] `/metrics` endpoint shows project metrics
- [ ] All operations traced with project_id
- [ ] 15/15 API key tests passing
- [ ] 12/12 metrics tests passing
- [ ] 12/12 tracing tests passing
- [ ] API documentation complete (1500+ lines)
- [ ] Python and cURL examples working
- [ ] 4 commits created
- [ ] PR created and ready for review

### Release
- [ ] Agent 2 PR merged
- [ ] Agent 1 PR merged (after rebase)
- [ ] All 1,470 tests passing
- [ ] v2.3.1 tagged
- [ ] Release notes published
- [ ] Documentation updated
- [ ] Grade: A (92/100) achieved

---

**Ready to launch?** Run: `./.claude/launch_v2.3.1_agents.sh`

**Questions?** See: `.claude/v2.3.1_completion_plan.md`

**Last Updated**: October 9, 2025
